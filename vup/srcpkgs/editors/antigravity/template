# Template file for 'antigravity'
pkgname=antigravity
version=1.13.3
_build=4533425205018624
revision=6
archs="x86_64"
depends="alsa-lib at-spi2-core cairo cups dbus expat glib gtk+3 libX11 libXcomposite libXdamage libXext libXfixes libXrandr libXScrnSaver libdrm libxcb libxkbcommon libxkbfile libxshmfence mesa nspr nss pango xdg-utils libsecret"
short_desc="An agentic development platform from Google"
maintainer="AmarBego <begovicamar@proton.me>"
license="custom:Google-Antigravity"
homepage="https://antigravity.google/"
restricted=yes
nopie=yes
nostrip=yes
noshlibprovides=yes
create_wrksrc=yes
hostmakedepends="tar"

distfiles="https://edgedl.me.gvt1.com/edgedl/release2/j0qc3/antigravity/stable/${version}-${_build}/linux-x64/Antigravity.tar.gz"
checksum=084dfbedf1049b363aa3ad7ba679eec8b80feaf29585accb90b5910ebb270048

do_install() {
	# Install app to /opt
	vmkdir opt/${pkgname}
	vcopy "Antigravity/*" opt/${pkgname}

	# Helper script with flags config support
	cat > antigravity.sh <<EOF
#!/bin/bash
XDG_CONFIG_HOME=\${XDG_CONFIG_HOME:-~/.config}

# Allow users to override command-line options
if [[ -f \$XDG_CONFIG_HOME/antigravity-flags.conf ]]; then
   ANTIGRAVITY_USER_FLAGS="\$(sed 's/#.*//' \$XDG_CONFIG_HOME/antigravity-flags.conf | tr '\n' ' ')"
fi

# Wayland native support
if [[ \$XDG_SESSION_TYPE == "wayland" ]]; then
   WAYLAND_FLAGS="--enable-features=UseOzonePlatform --ozone-platform=wayland --enable-wayland-ime"
fi

# Launch
exec /opt/${pkgname}/bin/antigravity "\$@" \$WAYLAND_FLAGS \$ANTIGRAVITY_USER_FLAGS
EOF
	vbin antigravity.sh antigravity

	# Desktop file
	cat > antigravity.desktop <<EOF
[Desktop Entry]
Name=Antigravity
Comment=An agentic development platform from Google
Exec=/usr/bin/antigravity %F
Icon=antigravity
Type=Application
Categories=Development;IDE;
StartupNotify=true
StartupWMClass=Antigravity
MimeType=text/plain;
EOF
	vinstall antigravity.desktop 644 usr/share/applications

	# Icon
	vinstall Antigravity/resources/app/resources/linux/code.png 644 usr/share/pixmaps ${pkgname}.png

	# License
	vlicense Antigravity/resources/app/LICENSE.txt
}
