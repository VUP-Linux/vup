# Template file for 'antigravity' 
pkgname=antigravity
version=1.13.3
revision=3
archs="x86_64"
create_wrksrc=yes
hostmakedepends="tar"
depends="
 alsa-lib
 at-spi2-core
 cairo
 dbus
 expat
 libgcc
 glib
 glibc
 gtk+3
 libX11
 libXcomposite
 libXdamage
 libXext
 libXfixes
 libxkbcommon
 libxkbfile
 libXrandr
 libxcb
 mesa
 nspr
 nss
 pango
 cups
"
short_desc="An agentic development platform from Google"
maintainer="AmarBego <begovicamar@proton.me>"
license="custom:Google-Antigravity"
homepage="https://antigravity.google/"
restricted=yes
nopie=yes
nostrip=yes
noshlibprovides=yes

distfiles="https://us-central1-apt.pkg.dev/projects/antigravity-auto-updater-dev/pool/antigravity-debian/antigravity_${version}-1766182170_amd64_365061c50063f9bd47a9ff88432261b8.deb"
checksum=d9920f9e0788245b1dab0f73a607b4eea00605bfb70e16795da1c1ac89eabd4b

do_install() {
	# deb contents are already extracted to $wrksrc by xbps-src
	cp -r usr ${DESTDIR}/

	# Fix zsh completions
	if [ -d ${DESTDIR}/usr/share/zsh/vendor-completions ]; then
		vmkdir usr/share/zsh/site-functions
		mv ${DESTDIR}/usr/share/zsh/vendor-completions/* ${DESTDIR}/usr/share/zsh/site-functions/
		rm -rf ${DESTDIR}/usr/share/zsh/vendor-completions
	fi

	# Move /usr/share/antigravity to /opt/Antigravity
	vmkdir opt
	mv ${DESTDIR}/usr/share/antigravity ${DESTDIR}/opt/Antigravity

	sed -i 's|/usr/share/antigravity|/opt/Antigravity|g' ${DESTDIR}/usr/share/applications/*.desktop
	sed -i 's|Exec=/opt/Antigravity/antigravity|Exec=/usr/bin/antigravity|g' ${DESTDIR}/usr/share/applications/*.desktop

	# Create binary symlink
	vmkdir usr/bin
	ln -sf /opt/Antigravity/bin/antigravity ${DESTDIR}/usr/bin/antigravity

	# License
	vlicense usr/share/antigravity/resources/app/LICENSE.txt
	vlicense usr/share/antigravity/LICENSES.chromium.html
}
